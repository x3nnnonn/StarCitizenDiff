syntax = "proto3";

package envoy.config.core.v3;

import "envoy/config/core/v3/base.proto";
import "google/protobuf/any.proto";
import "google/protobuf/duration.proto";
import "google/protobuf/empty.proto";
import "google/protobuf/struct.proto";
import "google/protobuf/wrappers.proto";
import "udpa/annotations/sensitive.proto";
import "udpa/annotations/status.proto";
import "udpa/annotations/versioning.proto";
import "validate/validate.proto";

message GrpcService {
  oneof target_specifier {
    .envoy.config.core.v3.GrpcService.EnvoyGrpc envoy_grpc = 1;
    .envoy.config.core.v3.GrpcService.GoogleGrpc google_grpc = 2;
  }
  .google.protobuf.Duration timeout = 3;
  repeated .envoy.config.core.v3.HeaderValue initial_metadata = 5;

  message EnvoyGrpc {
    string cluster_name = 1;
    string authority = 2;
  }
  message GoogleGrpc {
    string target_uri = 1;
    .envoy.config.core.v3.GrpcService.GoogleGrpc.ChannelCredentials channel_credentials = 2;
    repeated .envoy.config.core.v3.GrpcService.GoogleGrpc.CallCredentials call_credentials = 3;
    string stat_prefix = 4;
    string credentials_factory_name = 5;
    .google.protobuf.Struct config = 6;
    .google.protobuf.UInt32Value per_stream_buffer_limit_bytes = 7;
    .envoy.config.core.v3.GrpcService.GoogleGrpc.ChannelArgs channel_args = 8;

    message SslCredentials {
      .envoy.config.core.v3.DataSource root_certs = 1;
      .envoy.config.core.v3.DataSource private_key = 2;
      .envoy.config.core.v3.DataSource cert_chain = 3;
    }
    message GoogleLocalCredentials {
    }
    message ChannelCredentials {
      oneof credential_specifier {
        .envoy.config.core.v3.GrpcService.GoogleGrpc.SslCredentials ssl_credentials = 1;
        .google.protobuf.Empty google_default = 2;
        .envoy.config.core.v3.GrpcService.GoogleGrpc.GoogleLocalCredentials local_credentials = 3;
      }
    }
    message CallCredentials {
      oneof credential_specifier {
        string access_token = 1;
        .google.protobuf.Empty google_compute_engine = 2;
        string google_refresh_token = 3;
        .envoy.config.core.v3.GrpcService.GoogleGrpc.CallCredentials.ServiceAccountJWTAccessCredentials service_account_jwt_access = 4;
        .envoy.config.core.v3.GrpcService.GoogleGrpc.CallCredentials.GoogleIAMCredentials google_iam = 5;
        .envoy.config.core.v3.GrpcService.GoogleGrpc.CallCredentials.MetadataCredentialsFromPlugin from_plugin = 6;
        .envoy.config.core.v3.GrpcService.GoogleGrpc.CallCredentials.StsService sts_service = 7;
      }

      message ServiceAccountJWTAccessCredentials {
        string json_key = 1;
        uint64 token_lifetime_seconds = 2;
      }
      message GoogleIAMCredentials {
        string authorization_token = 1;
        string authority_selector = 2;
      }
      message MetadataCredentialsFromPlugin {
        string name = 1;
        oneof config_type {
          .google.protobuf.Any typed_config = 3;
        }
      }
      message StsService {
        string token_exchange_service_uri = 1;
        string resource = 2;
        string audience = 3;
        string scope = 4;
        string requested_token_type = 5;
        string subject_token_path = 6;
        string subject_token_type = 7;
        string actor_token_path = 8;
        string actor_token_type = 9;
      }
    }
    message ChannelArgs {
      map<string, .envoy.config.core.v3.GrpcService.GoogleGrpc.ChannelArgs.Value> args = 1;

      message Value {
        oneof value_specifier {
          string string_value = 1;
          int64 int_value = 2;
        }
      }
    }
  }
}

