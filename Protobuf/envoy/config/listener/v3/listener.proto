syntax = "proto3";

package envoy.config.listener.v3;

import "envoy/config/accesslog/v3/accesslog.proto";
import "envoy/config/core/v3/address.proto";
import "envoy/config/core/v3/base.proto";
import "envoy/config/core/v3/extension.proto";
import "envoy/config/core/v3/socket_option.proto";
import "envoy/config/listener/v3/api_listener.proto";
import "envoy/config/listener/v3/listener_components.proto";
import "envoy/config/listener/v3/udp_listener_config.proto";
import "google/protobuf/duration.proto";
import "google/protobuf/wrappers.proto";
import "xds/annotations/v3/status.proto";
import "xds/core/v3/collection_entry.proto";
import "xds/type/matcher/v3/matcher.proto";
import "envoy/annotations/deprecation.proto";
import "udpa/annotations/security.proto";
import "udpa/annotations/status.proto";
import "udpa/annotations/versioning.proto";
import "validate/validate.proto";

message AdditionalAddress {
  .envoy.config.core.v3.Address address = 1;
}

message ListenerCollection {
  repeated .xds.core.v3.CollectionEntry entries = 1;
}

message Listener {
  string name = 1;
  .envoy.config.core.v3.Address address = 2;
  repeated .envoy.config.listener.v3.AdditionalAddress additional_addresses = 33;
  string stat_prefix = 28;
  repeated .envoy.config.listener.v3.FilterChain filter_chains = 3;
  .xds.type.matcher.v3.Matcher filter_chain_matcher = 32;
  .google.protobuf.BoolValue use_original_dst = 4;
  .envoy.config.listener.v3.FilterChain default_filter_chain = 25;
  .google.protobuf.UInt32Value per_connection_buffer_limit_bytes = 5;
  .envoy.config.core.v3.Metadata metadata = 6;
  .envoy.config.listener.v3.Listener.DeprecatedV1 deprecated_v1 = 7 [ deprecated = true ];
  .envoy.config.listener.v3.Listener.DrainType drain_type = 8;
  repeated .envoy.config.listener.v3.ListenerFilter listener_filters = 9;
  .google.protobuf.Duration listener_filters_timeout = 15;
  bool continue_on_listener_filters_timeout = 17;
  .google.protobuf.BoolValue transparent = 10;
  .google.protobuf.BoolValue freebind = 11;
  repeated .envoy.config.core.v3.SocketOption socket_options = 13;
  .google.protobuf.UInt32Value tcp_fast_open_queue_length = 12;
  .envoy.config.core.v3.TrafficDirection traffic_direction = 16;
  .envoy.config.listener.v3.UdpListenerConfig udp_listener_config = 18;
  .envoy.config.listener.v3.ApiListener api_listener = 19;
  .envoy.config.listener.v3.Listener.ConnectionBalanceConfig connection_balance_config = 20;
  bool reuse_port = 21 [ deprecated = true ];
  .google.protobuf.BoolValue enable_reuse_port = 29;
  repeated .envoy.config.accesslog.v3.AccessLog access_log = 22;
  .google.protobuf.UInt32Value tcp_backlog_size = 24;
  .google.protobuf.BoolValue bind_to_port = 26;
  oneof listener_specifier {
    .envoy.config.listener.v3.Listener.InternalListenerConfig internal_listener = 27;
  }
  bool enable_mptcp = 30;
  bool ignore_global_conn_limit = 31;

  message DeprecatedV1 {
    .google.protobuf.BoolValue bind_to_port = 1;
  }

  message ConnectionBalanceConfig {
    oneof balance_type {
      .envoy.config.listener.v3.Listener.ConnectionBalanceConfig.ExactBalance exact_balance = 1;
      .envoy.config.core.v3.TypedExtensionConfig extend_balance = 2;
    }

    message ExactBalance {
    }
  }

  message InternalListenerConfig {}

  enum DrainType {
    DEFAULT = 0;
    MODIFY_ONLY = 1;
  }
}

